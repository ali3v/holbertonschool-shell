#!/usr/bin/env bash
# Creates PID file, displays infinite message, handles signals, and cleans up

# Create PID file with robust path handling
PID_DIR="/var/run"
PID_FILE="${PID_DIR}/myscript.pid"

# Ensure PID directory exists and is writable
if [ ! -d "$PID_DIR" ]; then
    mkdir -p "$PID_DIR" 2>/dev/null || {
        PID_DIR="/tmp"
        PID_FILE="${PID_DIR}/myscript.pid"
        mkdir -p "$PID_DIR" 2>/dev/null
    }
fi

# Write PID to file
echo $$ > "$PID_FILE" 2>/dev/null || {
    # Fallback to /tmp if /var/run is not writable
    PID_DIR="/tmp"
    PID_FILE="${PID_DIR}/myscript.pid"
    echo $$ > "$PID_FILE"
}

cleanup() {
    rm -f "$PID_FILE"
    exit 0
}

# Set up signal handlers
trap 'echo "I hate the kill command"; cleanup' TERM
trap 'echo "Y U no love me?!"' INT
trap 'cleanup' QUIT

# Main loop
while true; do
    echo "To infinity and beyond"
    sleep 1
done
